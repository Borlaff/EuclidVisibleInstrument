<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Data reduction tools &mdash; VIS 1.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="VIS 1.1 documentation" href="index.html" />
    <link rel="next" title="VIS data analysis tools" href="analysis.html" />
    <link rel="prev" title="Simulation tools" href="simulator.html" /> 
  </head>
  <body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="analysis.html" title="VIS data analysis tools"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="simulator.html" title="Simulation tools"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">home</a>|&nbsp;</li>
        <li><a href="search.html">search</a>|&nbsp;</li>
 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Data reduction tools</a><ul>
<li><a class="reference internal" href="#vis-data-reduction-and-processing">VIS Data Reduction and Processing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-analysis.biasCalibration">VIS data reduction studies</a><ul>
<li><a class="reference internal" href="#bias-calibration">Bias Calibration</a></li>
<li><a class="reference internal" href="#flat-field-calibration">Flat Field Calibration</a></li>
<li><a class="reference internal" href="#non-linearity-i-detection-chain">Non-linearity I: Detection Chain</a></li>
<li><a class="reference internal" href="#testing-the-cti-correction-algorithm">Testing the CTI Correction Algorithm</a></li>
<li><a class="reference internal" href="#cosmic-ray-rejection">Cosmic Ray Rejection</a></li>
<li><a class="reference internal" href="#impact-of-ghost-images">Impact of Ghost Images</a></li>
<li><a class="reference internal" href="#non-linearity-ii-model-transfer">Non-linearity II: Model Transfer</a></li>
<li><a class="reference internal" href="#background-subtraction">Background Subtraction</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="simulator.html"
                        title="previous chapter">Simulation tools</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="analysis.html"
                        title="next chapter">VIS data analysis tools</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="module-reduction.reduceVISdata">
<span id="data-reduction-tools"></span><h1>Data reduction tools<a class="headerlink" href="#module-reduction.reduceVISdata" title="Permalink to this headline">¶</a></h1>
<div class="section" id="vis-data-reduction-and-processing">
<h2>VIS Data Reduction and Processing<a class="headerlink" href="#vis-data-reduction-and-processing" title="Permalink to this headline">¶</a></h2>
<p>This simple script can be used to reduce (simulated) VIS data.</p>
<p>The script was initially written for reducing a single CCD data.
However, since the version 0.5 the script tries to guess if the
input is a single quadrant then reduce correctly.</p>
<p>The script performs the following data reduction steps:</p>
<div class="highlight-python"><div class="highlight"><pre>1 Bias correction
2 CTI correction
3 Flat fielding (only if an input file is provided)
</pre></div>
</div>
<p>To Run:</p>
<div class="highlight-python"><div class="highlight"><pre>python reduceVISdata.py -i VISCCD.fits -b superBiasVIS.fits -f SuperFlatField.fits
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">requires:</th><td class="field-body">PyFITS</td>
</tr>
<tr class="field-even field"><th class="field-name">requires:</th><td class="field-body">NumPy</td>
</tr>
<tr class="field-odd field"><th class="field-name">requires:</th><td class="field-body">CDM03 (FORTRAN code, f2py -c -m cdm03 cdm03.f90)</td>
</tr>
<tr class="field-even field"><th class="field-name">author:</th><td class="field-body">Sami-Matias Niemi</td>
</tr>
<tr class="field-odd field"><th class="field-name">contact:</th><td class="field-body"><a class="reference external" href="mailto:smn2&#37;&#52;&#48;mssl&#46;ucl&#46;ac&#46;uk">smn2<span>&#64;</span>mssl<span>&#46;</span>ucl<span>&#46;</span>ac<span>&#46;</span>uk</a></td>
</tr>
<tr class="field-even field"><th class="field-name">version:</th><td class="field-body">0.5</td>
</tr>
</tbody>
</table>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<ol class="last arabic simple">
<li>implement background/sky subtraction</li>
</ol>
</div>
</div>
<dl class="class">
<dt id="reduction.reduceVISdata.reduceVISdata">
<em class="property">class </em><tt class="descclassname">reduction.reduceVISdata.</tt><tt class="descname">reduceVISdata</tt><big>(</big><em>values</em>, <em>log</em><big>)</big><a class="headerlink" href="#reduction.reduceVISdata.reduceVISdata" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple class to reduce VIS data.</p>
<dl class="method">
<dt id="reduction.reduceVISdata.reduceVISdata.applyCTICorrection">
<tt class="descname">applyCTICorrection</tt><big>(</big><big>)</big><a class="headerlink" href="#reduction.reduceVISdata.reduceVISdata.applyCTICorrection" title="Permalink to this definition">¶</a></dt>
<dd><p>Applies a CTI correction in electrons using CDM03 CTI model.
Converts the data to electrons using the gain value given in self.values.
The number of forward reads is defined by self.values[&#8216;order&#8217;] parameter.</p>
<p>Bristow &amp; Alexov (2003) algorithm further developed for HST data
processing by Massey, Rhodes et al.</p>
<p>There is probably an excess of .copy() calls here, but I had some problems
when calling the Fortran code so I added them for now.</p>
</dd></dl>

<dl class="method">
<dt id="reduction.reduceVISdata.reduceVISdata.flatfield">
<tt class="descname">flatfield</tt><big>(</big><big>)</big><a class="headerlink" href="#reduction.reduceVISdata.reduceVISdata.flatfield" title="Permalink to this definition">¶</a></dt>
<dd><p>Take into account pixel-to-pixel non-uniformity through multiplicative flat fielding.</p>
</dd></dl>

<dl class="method">
<dt id="reduction.reduceVISdata.reduceVISdata.subtractBias">
<tt class="descname">subtractBias</tt><big>(</big><big>)</big><a class="headerlink" href="#reduction.reduceVISdata.reduceVISdata.subtractBias" title="Permalink to this definition">¶</a></dt>
<dd><p>Simply subtracts self.bias from the input data.</p>
</dd></dl>

<dl class="method">
<dt id="reduction.reduceVISdata.reduceVISdata.writeFITSfile">
<tt class="descname">writeFITSfile</tt><big>(</big><big>)</big><a class="headerlink" href="#reduction.reduceVISdata.reduceVISdata.writeFITSfile" title="Permalink to this definition">¶</a></dt>
<dd><p>Write out FITS files using PyFITS.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-analysis.biasCalibration">
<span id="vis-data-reduction-studies"></span><h1>VIS data reduction studies<a class="headerlink" href="#module-analysis.biasCalibration" title="Permalink to this headline">¶</a></h1>
<div class="section" id="bias-calibration">
<h2>Bias Calibration<a class="headerlink" href="#bias-calibration" title="Permalink to this headline">¶</a></h2>
<p>This simple script can be used to study the number of bias frames required to meet the VIS calibration requirements.</p>
<p>The following requirements related to the bias calibration has been taken from GDPRD.</p>
<p>R-GDP-CAL-052:
The contribution of the residuals of VIS bias subtraction to the <em>error on the determination of each ellipticity
component</em> of the local PSF shall not exceed 3x10-5 (one sigma).</p>
<p>R-GDP-CAL-062:
The contribution of the residuals of VIS bias subtraction to the <em>relative error</em> sigma(R2)/R2 on the determination of
the local PSF R2 shall not exceed 1x10-4 (one sigma).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">requires:</th><td class="field-body">PyFITS</td>
</tr>
<tr class="field-even field"><th class="field-name">requires:</th><td class="field-body">NumPy</td>
</tr>
<tr class="field-odd field"><th class="field-name">requires:</th><td class="field-body">matplotlib</td>
</tr>
<tr class="field-even field"><th class="field-name">requires:</th><td class="field-body">VISsim-Python</td>
</tr>
<tr class="field-odd field"><th class="field-name">version:</th><td class="field-body">0.95</td>
</tr>
<tr class="field-even field"><th class="field-name">author:</th><td class="field-body">Sami-Matias Niemi</td>
</tr>
<tr class="field-odd field"><th class="field-name">contact:</th><td class="field-body"><a class="reference external" href="mailto:smn2&#37;&#52;&#48;mssl&#46;ucl&#46;ac&#46;uk">smn2<span>&#64;</span>mssl<span>&#46;</span>ucl<span>&#46;</span>ac<span>&#46;</span>uk</a></td>
</tr>
</tbody>
</table>
<dl class="function">
<dt id="analysis.biasCalibration.addReadoutNoise">
<tt class="descclassname">analysis.biasCalibration.</tt><tt class="descname">addReadoutNoise</tt><big>(</big><em>data</em>, <em>readnoise=4.5</em>, <em>gain=3.1</em>, <em>number=1</em><big>)</big><a class="headerlink" href="#analysis.biasCalibration.addReadoutNoise" title="Permalink to this definition">¶</a></dt>
<dd><p>Add readout noise to the input data. The readout noise is the median of the number of frames.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>data</strong> (<em>ndarray</em>) &#8211; input data to which the readout noise will be added to [ADUs]</li>
<li><strong>readnoise</strong> (<em>float</em>) &#8211; standard deviation of the read out noise [electrons]</li>
<li><strong>gain</strong> (<em>float</em>) &#8211; the gain factor that is used to convert electrons to ADUs</li>
<li><strong>number</strong> (<em>int</em>) &#8211; number of read outs to median combine before adding to the data [default=1]</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">data + read out noise</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">ndarray [same as input data]</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="analysis.biasCalibration.findTolerableErrorPiston">
<tt class="descclassname">analysis.biasCalibration.</tt><tt class="descname">findTolerableErrorPiston</tt><big>(</big><em>log</em>, <em>file='data/psf12x.fits'</em>, <em>oversample=12.0</em>, <em>samples=12</em>, <em>psfs=4000</em>, <em>sigma=0.36</em>, <em>iterations=5</em>, <em>debug=False</em><big>)</big><a class="headerlink" href="#analysis.biasCalibration.findTolerableErrorPiston" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate ellipticity and size for PSFs of different scaling when there is a residual
bias offset.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>sigma</strong> (<em>float</em>) &#8211; 1sigma radius of the Gaussian weighting function for shape measurements</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="analysis.biasCalibration.findTolerableErrorSlope">
<tt class="descclassname">analysis.biasCalibration.</tt><tt class="descname">findTolerableErrorSlope</tt><big>(</big><em>log</em>, <em>file='data/psf12x.fits'</em>, <em>oversample=12.0</em>, <em>samples=12</em>, <em>psfs=4000</em>, <em>sigma=0.36</em>, <em>iterations=5</em>, <em>pixels=60</em><big>)</big><a class="headerlink" href="#analysis.biasCalibration.findTolerableErrorSlope" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate ellipticity and size for PSFs of different scaling when there is a residual
bias slope.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>sigma</strong> (<em>float</em>) &#8211; 1sigma radius of the Gaussian weighting function for shape measurements</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="analysis.biasCalibration.pistonKnowledge">
<tt class="descclassname">analysis.biasCalibration.</tt><tt class="descname">pistonKnowledge</tt><big>(</big><em>log</em>, <em>file='data/psf2x.fits'</em>, <em>oversample=2.0</em>, <em>psfs=1000</em>, <em>sigma=0.36</em>, <em>iterations=4</em>, <em>debug=False</em><big>)</big><a class="headerlink" href="#analysis.biasCalibration.pistonKnowledge" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="analysis.biasCalibration.plotDeltaEs">
<tt class="descclassname">analysis.biasCalibration.</tt><tt class="descname">plotDeltaEs</tt><big>(</big><em>deltae1</em>, <em>deltae2</em>, <em>deltae</em>, <em>output</em>, <em>title=''</em>, <em>ymax=8</em>, <em>req=3</em><big>)</big><a class="headerlink" href="#analysis.biasCalibration.plotDeltaEs" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a simple plot showing the errors in the ellipticity components.</p>
</dd></dl>

<dl class="function">
<dt id="analysis.biasCalibration.plotEs">
<tt class="descclassname">analysis.biasCalibration.</tt><tt class="descname">plotEs</tt><big>(</big><em>deltae1</em>, <em>deltae2</em>, <em>deltae</em>, <em>output</em>, <em>title=''</em><big>)</big><a class="headerlink" href="#analysis.biasCalibration.plotEs" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a simple plot showing the ellipticity components.</p>
</dd></dl>

<dl class="function">
<dt id="analysis.biasCalibration.plotNumberOfFramesDelta">
<tt class="descclassname">analysis.biasCalibration.</tt><tt class="descname">plotNumberOfFramesDelta</tt><big>(</big><em>results</em>, <em>timeStamp=False</em><big>)</big><a class="headerlink" href="#analysis.biasCalibration.plotNumberOfFramesDelta" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a simple plot to combine and show the results for errors (delta).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>results</strong> (<em>dict</em>) &#8211; results to be plotted</li>
<li><strong>timeStamp</strong> (<em>bool</em>) &#8211; whether to include a time stamp in the output image</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="analysis.biasCalibration.plotNumberOfFramesSigma">
<tt class="descclassname">analysis.biasCalibration.</tt><tt class="descname">plotNumberOfFramesSigma</tt><big>(</big><em>results</em>, <em>reqe=3e-05</em>, <em>reqr2=0.0001</em>, <em>shift=0.1</em>, <em>timeStamp=False</em><big>)</big><a class="headerlink" href="#analysis.biasCalibration.plotNumberOfFramesSigma" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a simple plot to combine and show the results.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>results</strong> (<em>dict</em>) &#8211; results to be plotted</li>
<li><strong>req</strong> (<em>float</em>) &#8211; the requirement</li>
<li><strong>ymax</strong> (<em>int or float</em>) &#8211; maximum value to show on the y-axis</li>
<li><strong>shift</strong> (<em>float</em>) &#8211; the amount to shift the e2 results on the abscissa (for clarity)</li>
<li><strong>timeStamp</strong> (<em>bool</em>) &#8211; whether to include a time stamp in the output image</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="analysis.biasCalibration.simpleAnalytical">
<tt class="descclassname">analysis.biasCalibration.</tt><tt class="descname">simpleAnalytical</tt><big>(</big><em>offset=1500</em>, <em>size=(50</em>, <em>50)</em>, <em>readnoise=4.5</em>, <em>gain=3.1</em>, <em>req=0.6</em><big>)</big><a class="headerlink" href="#analysis.biasCalibration.simpleAnalytical" title="Permalink to this definition">¶</a></dt>
<dd><p>A simple function to test the area of pixels needed (defined by size) to derive the
pixel offset to the level of required number of electrons given the readout noise and
the gain of the system.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>offset</strong> (<em>int</em>) &#8211; the offset level in electrons [default = 1500]</li>
<li><strong>size</strong> (<em>tuple</em>) &#8211; area describing the number of pixels available [default = (50, 50)]</li>
<li><strong>readnoise</strong> (<em>float</em>) &#8211; readout noise of the full detection chain [default = 4.5]</li>
<li><strong>gain</strong> (<em>float</em>) &#8211; gain of the detection system [default = 3.1]</li>
<li><strong>req</strong> (<em>float</em>) &#8211; required level to reach in electrons [default = 0.1]</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">none</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="analysis.biasCalibration.testBiasCalibrationDelta">
<tt class="descclassname">analysis.biasCalibration.</tt><tt class="descname">testBiasCalibrationDelta</tt><big>(</big><em>log</em>, <em>numdata=2066</em>, <em>floor=995</em>, <em>xsize=2048</em>, <em>ysize=2066</em>, <em>order=3</em>, <em>biases=15</em>, <em>surfaces=100</em>, <em>file='psf1x.fits'</em>, <em>psfs=500</em>, <em>psfscale=1000.0</em>, <em>debug=False</em>, <em>plots=False</em><big>)</big><a class="headerlink" href="#analysis.biasCalibration.testBiasCalibrationDelta" title="Permalink to this definition">¶</a></dt>
<dd><p>Derive the PSF ellipticities for a given number of random surfaces with random PSF positions
and a given number of biases median combined and compare to the nominal PSF ellipticity.</p>
<p>This function can be used to derive the error (delta) in determining ellipticity and size given
a reference PSF.</p>
<p>Choices that need to be made and effect the results:</p>
<blockquote>
<div><ol class="arabic simple">
<li>bias surface that is assumed (amplitude, complexity, etc.)</li>
<li>whether the order of the polynomial surface to be fitted is known or not</li>
<li>size of the Gaussian weighting function when calculating the ellipticity components</li>
</ol>
</div></blockquote>
<p>There are also other choices such as the number of PSFs and scaling and the random numbers generated for
the surface that also affect the results, however, to a lesser degree.</p>
<p>Generates a set of plots that can be used to inspect the simulation.</p>
</dd></dl>

<dl class="function">
<dt id="analysis.biasCalibration.testBiasCalibrationSigma">
<tt class="descclassname">analysis.biasCalibration.</tt><tt class="descname">testBiasCalibrationSigma</tt><big>(</big><em>log</em>, <em>numdata=2066</em>, <em>floor=3500</em>, <em>xsize=2048</em>, <em>ysize=2066</em>, <em>order=3</em>, <em>biases=15</em>, <em>surfaces=100</em>, <em>file='psf1x.fits'</em>, <em>psfs=500</em>, <em>psfscale=100000.0</em>, <em>gain=3.1</em>, <em>debug=False</em>, <em>plots=True</em><big>)</big><a class="headerlink" href="#analysis.biasCalibration.testBiasCalibrationSigma" title="Permalink to this definition">¶</a></dt>
<dd><p>Derive the PSF ellipticities for a given number of random surfaces with random PSF positions
and a given number of biases median combined.</p>
<p>This function is to derive the the actual values so that the knowledge (variance) can be studied.</p>
<p>Choices that need to be made and effect the results:</p>
<blockquote>
<div><ol class="arabic simple">
<li>bias surface that is assumed (amplitude, complexity, etc.)</li>
<li>whether the order of the polynomial surface to be fitted is known or not</li>
<li>size of the Gaussian weighting function when calculating the ellipticity components</li>
</ol>
</div></blockquote>
<p>There are also other choices such as the number of PSFs and scaling and the random numbers generated for
the surface that also affect the results, however, to a lesser degree.</p>
<p>Generates a set of plots that can be used to inspect the simulation.</p>
</dd></dl>

</div>
<span class="target" id="module-analysis.FlatfieldCalibration"></span><div class="section" id="flat-field-calibration">
<h2>Flat Field Calibration<a class="headerlink" href="#flat-field-calibration" title="Permalink to this headline">¶</a></h2>
<p>This simple script can be used to study the number of flat fields required to meet the VIS calibration requirements.</p>
<p>The following requirements related to the flat field calibration has been taken from GDPRD.</p>
<p>R-GDP-CAL-054:
The contribution of the residuals of VIS flat-field correction to the error on the determination of each
ellipticity component of the local PSF shall not exceed 3x10-5 (one sigma).</p>
<p>R-GDP-CAL-064:
The contribution of the residuals of VIS flat-field correction to the relative error on the determination
of the local PSF R2 shall not exceed 1x10-4 (one sigma).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The amount of cosmic rays in the simulated input images might be too low, because the exposure was
set to 10 seconds and cosmic rays were calculated based on this. However, in reality the readout
takes about 80 seconds. Thus, the last row is effected by cosmic a lot more than by assuming a single
10 second exposure.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">requires:</th><td class="field-body">PyFITS</td>
</tr>
<tr class="field-even field"><th class="field-name">requires:</th><td class="field-body">NumPy</td>
</tr>
<tr class="field-odd field"><th class="field-name">requires:</th><td class="field-body">SciPy</td>
</tr>
<tr class="field-even field"><th class="field-name">requires:</th><td class="field-body">matplotlib</td>
</tr>
<tr class="field-odd field"><th class="field-name">requires:</th><td class="field-body">VISsim-Python</td>
</tr>
<tr class="field-even field"><th class="field-name">version:</th><td class="field-body">0.97</td>
</tr>
<tr class="field-odd field"><th class="field-name">author:</th><td class="field-body">Sami-Matias Niemi</td>
</tr>
<tr class="field-even field"><th class="field-name">contact:</th><td class="field-body"><a class="reference external" href="mailto:s&#46;niemi&#37;&#52;&#48;ucl&#46;ac&#46;uk">s<span>&#46;</span>niemi<span>&#64;</span>ucl<span>&#46;</span>ac<span>&#46;</span>uk</a></td>
</tr>
</tbody>
</table>
<dl class="function">
<dt id="analysis.FlatfieldCalibration.findTolerableError">
<tt class="descclassname">analysis.FlatfieldCalibration.</tt><tt class="descname">findTolerableError</tt><big>(</big><em>log</em>, <em>file='data/psf4x.fits'</em>, <em>oversample=4.0</em>, <em>psfs=10000</em>, <em>iterations=7</em>, <em>sigma=0.75</em><big>)</big><a class="headerlink" href="#analysis.FlatfieldCalibration.findTolerableError" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate ellipticity and size for PSFs of different scaling when there is a residual
pixel-to-pixel variations.</p>
</dd></dl>

<dl class="function">
<dt id="analysis.FlatfieldCalibration.generateResidualFlatField">
<tt class="descclassname">analysis.FlatfieldCalibration.</tt><tt class="descname">generateResidualFlatField</tt><big>(</big><em>files='Q0*flatfield*.fits'</em>, <em>combine=77</em>, <em>lampfile='data/VIScalibrationUnitflux.fits'</em>, <em>reference='data/VISFlatField1percent.fits'</em>, <em>gain=3.5</em>, <em>plots=False</em>, <em>debug=False</em><big>)</big><a class="headerlink" href="#analysis.FlatfieldCalibration.generateResidualFlatField" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate a median combined flat field residual from given input files.</p>
<p>Randomly draws a given number (kw combine) of files from the file list identified using the files kw.
Median combine all files before the lamp profile given by lampfile kw is being divided out. This
will produce a derived flat field. This flat can be compared against the reference that was used
to produce the initial data to derive a residual flat that describes the error in the flat field
that was derived.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>files</strong> (<em>str</em>) &#8211; wildcard flagged name identifier for the FITS files to be used for generating a flat</li>
<li><strong>combine</strong> (<em>int</em>) &#8211; number of files to median combine</li>
<li><strong>lampfile</strong> (<em>str</em>) &#8211; name of the calibration unit flux profile FITS file</li>
<li><strong>reference</strong> (<em>str</em>) &#8211; name of the reference pixel-to-pixel flat field FITS file</li>
<li><strong>gain</strong> (<em>float</em>) &#8211; gain factor [e/ADU]</li>
<li><strong>plots</strong> (<em>boolean</em>) &#8211; whether or not to generate plots</li>
<li><strong>debug</strong> (<em>boolean</em>) &#8211; whether or not to produce output FITS files</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Remember to use an appropriate lamp and reference files so that the error in the derived
flat field can be correctly calculated.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">residual flat field (difference between the generated flat and the reference)</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">ndarray</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="analysis.FlatfieldCalibration.plotNumberOfFrames">
<tt class="descclassname">analysis.FlatfieldCalibration.</tt><tt class="descname">plotNumberOfFrames</tt><big>(</big><em>results</em>, <em>reqe=3e-05</em>, <em>reqr2=0.0001</em>, <em>shift=0.1</em>, <em>outdir='results'</em>, <em>timeStamp=False</em><big>)</big><a class="headerlink" href="#analysis.FlatfieldCalibration.plotNumberOfFrames" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a simple plot to combine and show the results.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>res</strong> (<em>list</em>) &#8211; results to be plotted [results dictionary, reference values]</li>
<li><strong>reqe</strong> (<em>float</em>) &#8211; the requirement for ellipticity [default=3e-5]</li>
<li><strong>reqr2</strong> (<em>float</em>) &#8211; the requirement for size R2 [default=1e-4]</li>
<li><strong>shift</strong> (<em>float</em>) &#8211; the amount to shift the e2 results on the abscissa (for clarity)</li>
<li><strong>outdir</strong> (<em>str</em>) &#8211; output directory to which the plots will be saved to</li>
<li><strong>timeStamp</strong> (<em>bool</em>) &#8211; whether or not to include a time stamp to the output image</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">None</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="analysis.FlatfieldCalibration.testFlatCalibration">
<tt class="descclassname">analysis.FlatfieldCalibration.</tt><tt class="descname">testFlatCalibration</tt><big>(</big><em>log</em>, <em>flats</em>, <em>surfaces=10</em>, <em>file='data/psf1x.fits'</em>, <em>psfs=5000</em>, <em>sigma=0.75</em>, <em>iterations=7</em>, <em>weighting=True</em>, <em>plot=False</em>, <em>debug=False</em><big>)</big><a class="headerlink" href="#analysis.FlatfieldCalibration.testFlatCalibration" title="Permalink to this definition">¶</a></dt>
<dd><p>Derive the PSF ellipticities for a given number of random surfaces with random PSF positions
and a given number of flat fields median combined.</p>
<p>This function is to derive the the actual values so that the knowledge (variance) can be studied.</p>
</dd></dl>

<dl class="function">
<dt id="analysis.FlatfieldCalibration.testNoFlatfieldingEffects">
<tt class="descclassname">analysis.FlatfieldCalibration.</tt><tt class="descname">testNoFlatfieldingEffects</tt><big>(</big><em>log</em>, <em>file='data/psf1x.fits'</em>, <em>oversample=1.0</em>, <em>psfs=500</em><big>)</big><a class="headerlink" href="#analysis.FlatfieldCalibration.testNoFlatfieldingEffects" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate ellipticity and size variance and error in case of no pixel-to-pixel flat field correction.</p>
</dd></dl>

</div>
<span class="target" id="module-analysis.nonlinearityCalibration"></span><div class="section" id="non-linearity-i-detection-chain">
<h2>Non-linearity I: Detection Chain<a class="headerlink" href="#non-linearity-i-detection-chain" title="Permalink to this headline">¶</a></h2>
<p>This simple script can be used to study the error in the non-linearity correction that can be tolerated given the
requirements.</p>
<p>The following requirements related to the non-linearity have been taken from GDPRD.</p>
<p>R-GDP-CAL-058: The contribution of the residuals of the non-linearity correction on the error on the determination
of each ellipticity component of the local PSF shall not exceed 3x10**-5 (one sigma).</p>
<p>R-GDP-CAL-068: The contribution of the residuals of the non-linearity correction on the error on the relative
error sigma(R**2)/R**2 on the determination of the local PSF R**2 shall not exceed 1x10**-4 (one sigma).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">requires:</th><td class="field-body">PyFITS</td>
</tr>
<tr class="field-even field"><th class="field-name">requires:</th><td class="field-body">NumPy</td>
</tr>
<tr class="field-odd field"><th class="field-name">requires:</th><td class="field-body">SciPy</td>
</tr>
<tr class="field-even field"><th class="field-name">requires:</th><td class="field-body">matplotlib</td>
</tr>
<tr class="field-odd field"><th class="field-name">requires:</th><td class="field-body">VISsim-Python</td>
</tr>
<tr class="field-even field"><th class="field-name">version:</th><td class="field-body">0.97</td>
</tr>
<tr class="field-odd field"><th class="field-name">author:</th><td class="field-body">Sami-Matias Niemi</td>
</tr>
<tr class="field-even field"><th class="field-name">contact:</th><td class="field-body"><a class="reference external" href="mailto:s&#46;niemi&#37;&#52;&#48;ucl&#46;ac&#46;uk">s<span>&#46;</span>niemi<span>&#64;</span>ucl<span>&#46;</span>ac<span>&#46;</span>uk</a></td>
</tr>
</tbody>
</table>
<dl class="function">
<dt id="analysis.nonlinearityCalibration.plotResults">
<tt class="descclassname">analysis.nonlinearityCalibration.</tt><tt class="descname">plotResults</tt><big>(</big><em>results</em>, <em>reqe=3e-05</em>, <em>reqr2=0.0001</em>, <em>outdir='results'</em>, <em>timeStamp=False</em><big>)</big><a class="headerlink" href="#analysis.nonlinearityCalibration.plotResults" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a simple plot to combine and show the results.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>res</strong> (<em>list</em>) &#8211; results to be plotted [reference values, results dictionary]</li>
<li><strong>reqe</strong> (<em>float</em>) &#8211; the requirement for ellipticity [default=3e-5]</li>
<li><strong>reqr2</strong> (<em>float</em>) &#8211; the requirement for size R2 [default=1e-4]</li>
<li><strong>outdir</strong> (<em>str</em>) &#8211; output directory to which the plots will be saved to</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">None</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="analysis.nonlinearityCalibration.testNonlinearity">
<tt class="descclassname">analysis.nonlinearityCalibration.</tt><tt class="descname">testNonlinearity</tt><big>(</big><em>log</em>, <em>file='data/psf12x.fits'</em>, <em>oversample=12.0</em>, <em>sigma=0.75</em>, <em>phs=0.98</em>, <em>phases=None</em>, <em>psfs=5000</em>, <em>amps=12</em>, <em>multiplier=1.5</em>, <em>minerror=-5.0</em>, <em>maxerror=-1</em>, <em>linspace=False</em><big>)</big><a class="headerlink" href="#analysis.nonlinearityCalibration.testNonlinearity" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to study the error in the non-linearity correction on the knowledge of the PSF ellipticity and size.</p>
<p>The error has been assumed to follow a sinusoidal curve with random phase and a given number of angular
frequencies (defined by the multiplier). The amplitudes being studied, i.e. the size of the maximum deviation,
can be spaced either linearly or logarithmically.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>log</strong> (<em>instance</em>) &#8211; logger instance</li>
<li><strong>file</strong> (<em>str</em>) &#8211; name of the PSF FITS files to use [default=data/psf12x.fits]</li>
<li><strong>oversample</strong> &#8211; the PSF oversampling factor, which needs to match the input file [default=12]</li>
<li><strong>sigma</strong> (<em>float</em>) &#8211; 1sigma radius of the Gaussian weighting function for shape measurements</li>
<li><strong>phs</strong> (<em>float</em>) &#8211; phase in case phases = None</li>
<li><strong>phases</strong> (<em>None or int</em>) &#8211; if None then a single fixed phase will be applied, if an int then a given number of random
phases will be used</li>
<li><strong>psfs</strong> (<em>int</em>) &#8211; the number of PSFs to use.</li>
<li><strong>amps</strong> (<em>int</em>) &#8211; the number of individual samplings used when covering the error space</li>
<li><strong>multiplier</strong> (<em>int or float</em>) &#8211; the number of angular frequencies to be used</li>
<li><strong>minerror</strong> (<em>float</em>) &#8211; the minimum error to be covered, given in log10(min_error) [default=-5 i.e. 0.001%]</li>
<li><strong>maxerror</strong> (<em>float</em>) &#8211; the maximum error to be covered, given in log10(max_error) [default=-1 i.e. 10%]</li>
<li><strong>linspace</strong> (<em>boolean</em>) &#8211; whether the amplitudes of the error curves should be linearly or logarithmically spaced.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">reference value and results dictionaries</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">list</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<span class="target" id="module-analysis.testCTIcorrection"></span><div class="section" id="testing-the-cti-correction-algorithm">
<h2>Testing the CTI Correction Algorithm<a class="headerlink" href="#testing-the-cti-correction-algorithm" title="Permalink to this headline">¶</a></h2>
<p>This script can be used to test the CTI correction algorithm performance.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">requires:</th><td class="field-body">NumPy</td>
</tr>
<tr class="field-even field"><th class="field-name">requires:</th><td class="field-body">PyFITS</td>
</tr>
<tr class="field-odd field"><th class="field-name">requires:</th><td class="field-body">matplotlib</td>
</tr>
<tr class="field-even field"><th class="field-name">version:</th><td class="field-body">0.3</td>
</tr>
<tr class="field-odd field"><th class="field-name">author:</th><td class="field-body">Sami-Matias Niemi</td>
</tr>
<tr class="field-even field"><th class="field-name">contact:</th><td class="field-body"><a class="reference external" href="mailto:s&#46;niemi&#37;&#52;&#48;ucl&#46;ac&#46;uk">s<span>&#46;</span>niemi<span>&#64;</span>ucl<span>&#46;</span>ac<span>&#46;</span>uk</a></td>
</tr>
</tbody>
</table>
<dl class="function">
<dt id="analysis.testCTIcorrection.addCTI">
<tt class="descclassname">analysis.testCTIcorrection.</tt><tt class="descname">addCTI</tt><big>(</big><em>file</em>, <em>loc=1900</em>, <em>bcgr=72.2</em>, <em>thibautCDM03=False</em>, <em>beta=True</em>, <em>serial=1</em>, <em>parallel=1</em><big>)</big><a class="headerlink" href="#analysis.testCTIcorrection.addCTI" title="Permalink to this definition">¶</a></dt>
<dd><p>Add CTI trails to a FITS file or input data.</p>
</dd></dl>

<dl class="function">
<dt id="analysis.testCTIcorrection.cutoutRegions">
<tt class="descclassname">analysis.testCTIcorrection.</tt><tt class="descname">cutoutRegions</tt><big>(</big><em>files</em>, <em>xcen=1900</em>, <em>ycen=1900</em>, <em>side=140</em><big>)</big><a class="headerlink" href="#analysis.testCTIcorrection.cutoutRegions" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>files</strong> &#8211; </li>
<li><strong>xcen</strong> &#8211; </li>
<li><strong>ycen</strong> &#8211; </li>
<li><strong>side</strong> &#8211; </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="analysis.testCTIcorrection.plotResults">
<tt class="descclassname">analysis.testCTIcorrection.</tt><tt class="descname">plotResults</tt><big>(</big><em>results</em><big>)</big><a class="headerlink" href="#analysis.testCTIcorrection.plotResults" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot the CTI correction algorithm results.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>results</strong> &#8211; CTI test results</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">None</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="analysis.testCTIcorrection.plotResultsNoNoise">
<tt class="descclassname">analysis.testCTIcorrection.</tt><tt class="descname">plotResultsNoNoise</tt><big>(</big><em>inputfile</em>, <em>title</em>, <em>bins=10</em><big>)</big><a class="headerlink" href="#analysis.testCTIcorrection.plotResultsNoNoise" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot the CTI correction algorithm results.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">None</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="analysis.testCTIcorrection.testCTIcorrection">
<tt class="descclassname">analysis.testCTIcorrection.</tt><tt class="descname">testCTIcorrection</tt><big>(</big><em>log</em>, <em>files</em>, <em>sigma=0.75</em>, <em>iterations=4</em>, <em>xcen=1900</em>, <em>ycen=1900</em>, <em>side=20</em><big>)</big><a class="headerlink" href="#analysis.testCTIcorrection.testCTIcorrection" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates PSF properties such as ellipticity and size from data without CTI and from
CTI data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>log</strong> (<em>instance</em>) &#8211; python logger instance</li>
<li><strong>files</strong> (<em>list</em>) &#8211; a list of files to be processed</li>
<li><strong>sigma</strong> (<em>float</em>) &#8211; size of the Gaussian weighting function</li>
<li><strong>iterations</strong> (<em>int</em>) &#8211; the number of iterations for the moment based shape estimator</li>
<li><strong>xcen</strong> (<em>int</em>) &#8211; x-coordinate of the object centre</li>
<li><strong>ycen</strong> (<em>int</em>) &#8211; y-coordinate of the object centre</li>
<li><strong>side</strong> (<em>int</em>) &#8211; size of the cutout around the centre (+/- side)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">ellipticity and size</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">dict</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="analysis.testCTIcorrection.testCTIcorrectionNonoise">
<tt class="descclassname">analysis.testCTIcorrection.</tt><tt class="descname">testCTIcorrectionNonoise</tt><big>(</big><em>log</em>, <em>files</em>, <em>output</em>, <em>sigma=0.75</em>, <em>iterations=4</em><big>)</big><a class="headerlink" href="#analysis.testCTIcorrection.testCTIcorrectionNonoise" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates PSF properties such as ellipticity and size from data w/ and w/o CTI.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>log</strong> (<em>instance</em>) &#8211; python logger instance</li>
<li><strong>files</strong> (<em>list</em>) &#8211; a list of files to be processed</li>
<li><strong>sigma</strong> (<em>float</em>) &#8211; size of the Gaussian weighting function</li>
<li><strong>iterations</strong> (<em>int</em>) &#8211; the number of iterations for the moment based shape estimator</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">ellipticity and size</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">dict</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="analysis.testCTIcorrection.useThibautsData">
<tt class="descclassname">analysis.testCTIcorrection.</tt><tt class="descname">useThibautsData</tt><big>(</big><em>log</em>, <em>output</em>, <em>bcgr=72.2</em>, <em>sigma=0.75</em>, <em>iterations=4</em>, <em>loc=1900</em>, <em>galaxies=1000</em>, <em>datadir='/Users/smn2/EUCLID/CTItesting/uniform/'</em>, <em>thibautCDM03=False</em>, <em>beta=False</em>, <em>serial=1</em>, <em>parallel=1</em><big>)</big><a class="headerlink" href="#analysis.testCTIcorrection.useThibautsData" title="Permalink to this definition">¶</a></dt>
<dd><p>Test the impact of CTI in case of no noise and no correction.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>log</strong> &#8211; logger instance</li>
<li><strong>bcgr</strong> &#8211; background in electrons for the CTI modelling</li>
<li><strong>sigma</strong> &#8211; size of the weighting function for the quadrupole moment</li>
<li><strong>iterations</strong> &#8211; number of iterations in the quadrupole moments estimation</li>
<li><strong>loc</strong> &#8211; location to which the galaxy will be placed [default=1900]</li>
<li><strong>galaxies</strong> &#8211; number of galaxies to use (&lt; 10000)</li>
<li><strong>datadir</strong> &#8211; directory pointing to the galaxy images</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<span class="target" id="module-analysis.cosmicrayCalibration"></span><div class="section" id="cosmic-ray-rejection">
<h2>Cosmic Ray Rejection<a class="headerlink" href="#cosmic-ray-rejection" title="Permalink to this headline">¶</a></h2>
<p>This simple script can be used to study the error in the cosmic ray rejection that can be tolerated given the
requirements.</p>
<p>The following requirements related to the cosmic rays have been taken from CalCD-B.</p>
<p>Note that the analysis is for a single star. Thus, if we consider a single exposure we can
relax the requirements given that there will be on average about 1850 stars in each field that
are usable for PSF modelling. Furthermore it shuold be noted that the presence of cosmic rays
will always increase the size. Because of this one cannot combine the contribution from cosmic
rays with other effects by adding each individual contribution in quadrature. It is more
appropriate to add the impact of cosmic rays to the size of the PSF linearly given the preferred
direction.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">requires:</th><td class="field-body">PyFITS</td>
</tr>
<tr class="field-even field"><th class="field-name">requires:</th><td class="field-body">NumPy</td>
</tr>
<tr class="field-odd field"><th class="field-name">requires:</th><td class="field-body">SciPy</td>
</tr>
<tr class="field-even field"><th class="field-name">requires:</th><td class="field-body">matplotlib</td>
</tr>
<tr class="field-odd field"><th class="field-name">requires:</th><td class="field-body">VISsim-Python</td>
</tr>
<tr class="field-even field"><th class="field-name">version:</th><td class="field-body">0.4</td>
</tr>
<tr class="field-odd field"><th class="field-name">author:</th><td class="field-body">Sami-Matias Niemi</td>
</tr>
<tr class="field-even field"><th class="field-name">contact:</th><td class="field-body"><a class="reference external" href="mailto:s&#46;niemi&#37;&#52;&#48;ucl&#46;ac&#46;uk">s<span>&#46;</span>niemi<span>&#64;</span>ucl<span>&#46;</span>ac<span>&#46;</span>uk</a></td>
</tr>
</tbody>
</table>
<dl class="function">
<dt id="analysis.cosmicrayCalibration.plotResults">
<tt class="descclassname">analysis.cosmicrayCalibration.</tt><tt class="descname">plotResults</tt><big>(</big><em>results</em>, <em>reqe=3e-05</em>, <em>reqr2=0.0001</em>, <em>outdir='results'</em>, <em>timeStamp=False</em><big>)</big><a class="headerlink" href="#analysis.cosmicrayCalibration.plotResults" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a simple plot to combine and show the results.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>res</strong> (<em>list</em>) &#8211; results to be plotted [reference values, results dictionary]</li>
<li><strong>reqe</strong> (<em>float</em>) &#8211; the requirement for ellipticity [default=3e-5]</li>
<li><strong>reqr2</strong> (<em>float</em>) &#8211; the requirement for size R2 [default=1e-4]</li>
<li><strong>outdir</strong> (<em>str</em>) &#8211; output directory to which the plots will be saved to</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">None</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="analysis.cosmicrayCalibration.testCosmicrayRejection">
<tt class="descclassname">analysis.cosmicrayCalibration.</tt><tt class="descname">testCosmicrayRejection</tt><big>(</big><em>log</em>, <em>file='data/psf1x.fits'</em>, <em>oversample=1.0</em>, <em>sigma=0.75</em>, <em>psfs=20000</em>, <em>scale=1000.0</em>, <em>min=1e-05</em>, <em>max=50</em>, <em>levels=15</em>, <em>covering=1.4</em>, <em>single=False</em><big>)</big><a class="headerlink" href="#analysis.cosmicrayCalibration.testCosmicrayRejection" title="Permalink to this definition">¶</a></dt>
<dd><p>This is for a single PSF.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>log</strong> &#8211; </li>
<li><strong>file</strong> &#8211; </li>
<li><strong>oversample</strong> &#8211; </li>
<li><strong>sigma</strong> &#8211; </li>
<li><strong>psfs</strong> &#8211; </li>
<li><strong>scale</strong> &#8211; </li>
<li><strong>min</strong> &#8211; </li>
<li><strong>max</strong> &#8211; </li>
<li><strong>levels</strong> &#8211; </li>
<li><strong>covering</strong> &#8211; </li>
<li><strong>single</strong> &#8211; </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="analysis.cosmicrayCalibration.testCosmicrayRejectionMultiPSF">
<tt class="descclassname">analysis.cosmicrayCalibration.</tt><tt class="descname">testCosmicrayRejectionMultiPSF</tt><big>(</big><em>log</em>, <em>file='data/psf1x.fits'</em>, <em>oversample=1.0</em>, <em>sigma=0.75</em>, <em>psfs=2000</em>, <em>scale=1000.0</em>, <em>min=0.0001</em>, <em>max=100.0</em>, <em>levels=9</em>, <em>covering=2.0</em>, <em>stars=1850</em>, <em>single=False</em><big>)</big><a class="headerlink" href="#analysis.cosmicrayCalibration.testCosmicrayRejectionMultiPSF" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>log</strong> &#8211; </li>
<li><strong>file</strong> &#8211; </li>
<li><strong>oversample</strong> &#8211; </li>
<li><strong>sigma</strong> &#8211; </li>
<li><strong>psfs</strong> &#8211; </li>
<li><strong>scale</strong> &#8211; </li>
<li><strong>min</strong> &#8211; </li>
<li><strong>max</strong> &#8211; </li>
<li><strong>levels</strong> &#8211; </li>
<li><strong>covering</strong> &#8211; </li>
<li><strong>single</strong> &#8211; </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<span class="target" id="module-analysis.analyseGhosts"></span><div class="section" id="impact-of-ghost-images">
<h2>Impact of Ghost Images<a class="headerlink" href="#impact-of-ghost-images" title="Permalink to this headline">¶</a></h2>
<p>This scripts can be used to study the impact of ghost images on the weak lensing measurements.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">requires:</th><td class="field-body">PyFITS</td>
</tr>
<tr class="field-even field"><th class="field-name">requires:</th><td class="field-body">NumPy (1.7.0 or newer for numpy.pad)</td>
</tr>
<tr class="field-odd field"><th class="field-name">requires:</th><td class="field-body">SciPy</td>
</tr>
<tr class="field-even field"><th class="field-name">requires:</th><td class="field-body">matplotlib</td>
</tr>
<tr class="field-odd field"><th class="field-name">requires:</th><td class="field-body">VISsim-Python</td>
</tr>
<tr class="field-even field"><th class="field-name">version:</th><td class="field-body">0.2</td>
</tr>
<tr class="field-odd field"><th class="field-name">author:</th><td class="field-body">Sami-Matias Niemi</td>
</tr>
<tr class="field-even field"><th class="field-name">contact:</th><td class="field-body"><a class="reference external" href="mailto:s&#46;niemi&#37;&#52;&#48;ucl&#46;ac&#46;uk">s<span>&#46;</span>niemi<span>&#64;</span>ucl<span>&#46;</span>ac<span>&#46;</span>uk</a></td>
</tr>
</tbody>
</table>
<dl class="function">
<dt id="analysis.analyseGhosts.analyseInFocusImpact">
<tt class="descclassname">analysis.analyseGhosts.</tt><tt class="descname">analyseInFocusImpact</tt><big>(</big><em>log</em>, <em>filename='data/psf4x.fits'</em>, <em>psfscale=100000</em>, <em>maxdistance=100</em>, <em>oversample=4.0</em>, <em>psfs=1000</em>, <em>iterations=6</em>, <em>sigma=0.75</em><big>)</big><a class="headerlink" href="#analysis.analyseGhosts.analyseInFocusImpact" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates PSF size and ellipticity when including another PSF scaled to a given level (requirement = 5e-5)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>log</strong> &#8211; </li>
<li><strong>filename</strong> &#8211; name of the PSF file to analyse</li>
<li><strong>psfscale</strong> &#8211; level to which the original PSF is scaled to</li>
<li><strong>maxdistance</strong> &#8211; maximum distance the ghost image can be from the original PSF (centre to centre)</li>
<li><strong>oversample</strong> &#8211; oversampling factor</li>
<li><strong>psfs</strong> &#8211; number of PSFs to analyse (number of ghosts in random locations)</li>
<li><strong>iterations</strong> &#8211; number of iterations in the shape measurement</li>
<li><strong>sigma</strong> &#8211; size of the Gaussian weighting function</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">results</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">dict</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="analysis.analyseGhosts.analyseOutofFocusImpact">
<tt class="descclassname">analysis.analyseGhosts.</tt><tt class="descname">analyseOutofFocusImpact</tt><big>(</big><em>log</em>, <em>filename='data/psf4x.fits'</em>, <em>psfscale=100000</em>, <em>maxdistance=100</em>, <em>inner=8</em>, <em>outer=60</em>, <em>oversample=4.0</em>, <em>psfs=5000</em>, <em>iterations=5</em>, <em>sigma=0.75</em>, <em>lowghost=-7</em>, <em>highghost=-2</em>, <em>samples=9</em><big>)</big><a class="headerlink" href="#analysis.analyseGhosts.analyseOutofFocusImpact" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates PSF size and ellipticity when including an out-of-focus doughnut of a given contrast level.
The dougnut pixel values are all scaled to a given scaling value (requirement 5e-5).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>log</strong> &#8211; logger instance</li>
<li><strong>filename</strong> &#8211; name of the PSF file to analyse</li>
<li><strong>psfscale</strong> &#8211; level to which the original PSF is scaled to</li>
<li><strong>maxdistance</strong> &#8211; maximum distance the ghost image can be from the original PSF (centre to centre)</li>
<li><strong>inner</strong> &#8211; inner radius of the out-of-focus doughnut</li>
<li><strong>outer</strong> &#8211; outer radius of the out-of-focus doughnut</li>
<li><strong>oversample</strong> &#8211; oversampling factor</li>
<li><strong>psfs</strong> &#8211; number of PSFs to analyse (number of ghosts in random locations)</li>
<li><strong>iterations</strong> &#8211; number of iterations in the shape measurement</li>
<li><strong>sigma</strong> &#8211; size of the Gaussian weighting function</li>
<li><strong>lowghost</strong> &#8211; log of the highest ghost contrast ratio to study</li>
<li><strong>highghost</strong> &#8211; log of the lowest ghost contrast ratio to study</li>
<li><strong>samples</strong> &#8211; number of points for the contrast ratio to study</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">results</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">dict</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="analysis.analyseGhosts.deleteAndMove">
<tt class="descclassname">analysis.analyseGhosts.</tt><tt class="descname">deleteAndMove</tt><big>(</big><em>dir</em>, <em>files='*.fits'</em><big>)</big><a class="headerlink" href="#analysis.analyseGhosts.deleteAndMove" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>dir</strong> &#8211; </li>
<li><strong>files</strong> &#8211; </li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"></p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="analysis.analyseGhosts.drawDoughnut">
<tt class="descclassname">analysis.analyseGhosts.</tt><tt class="descname">drawDoughnut</tt><big>(</big><em>inner</em>, <em>outer</em>, <em>oversample=1</em>, <em>plot=False</em><big>)</big><a class="headerlink" href="#analysis.analyseGhosts.drawDoughnut" title="Permalink to this definition">¶</a></dt>
<dd><p>Draws a doughnut shape with a given inner and outer radius.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>inner</strong> (<em>float</em>) &#8211; inner radius in pixels</li>
<li><strong>outer</strong> (<em>float</em>) &#8211; outer radius in pixels</li>
<li><strong>oversample</strong> (<em>int</em>) &#8211; oversampling factor [default=1]</li>
<li><strong>plot</strong> (<em>bool</em>) &#8211; whether to generate a plot showing the doughnut or not</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">image, xcentre, ycentre</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">list</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="analysis.analyseGhosts.objectDetection">
<tt class="descclassname">analysis.analyseGhosts.</tt><tt class="descname">objectDetection</tt><big>(</big><em>log</em>, <em>magnitude=24.5</em>, <em>exptime=565</em>, <em>exposures=3</em>, <em>fpeak=0.7</em>, <em>offset=0.5</em>, <em>covering=2550</em>, <em>ghostlevels=(6e-07</em>, <em>1e-06</em>, <em>4e-06</em>, <em>5e-06</em>, <em>1e-05</em>, <em>5e-05)</em><big>)</big><a class="headerlink" href="#analysis.analyseGhosts.objectDetection" title="Permalink to this definition">¶</a></dt>
<dd><p>Derive area loss in case of object detection i.e. the SNR drops below the requirement.
Assumes that a ghost covers the covering number of pixels and that the peak pixel of a
point source contains fpeak fraction of the total counts. An offset between the V-band
and VIS band is applied as VIS = V + offset.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>log</strong> &#8211; logger instance</li>
<li><strong>magnitude</strong> &#8211; magnitude limit of the objects to be detected</li>
<li><strong>exptime</strong> &#8211; exposure time of an individual exposure in seconds</li>
<li><strong>exposures</strong> &#8211; number of exposures combined in the data analysis</li>
<li><strong>fpeak</strong> &#8211; PSF peak fraction</li>
<li><strong>offset</strong> &#8211; offset between the V-band and the VIS band, VIS = V + offset</li>
<li><strong>covering</strong> &#8211; covering fraction of a single ghost in pixels</li>
<li><strong>ghostlevels</strong> &#8211; a tuple of ghost levels to inspect</li>
<li><strong>ghostlevels</strong> &#8211; tuple</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">None</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="analysis.analyseGhosts.plotGhostContribution">
<tt class="descclassname">analysis.analyseGhosts.</tt><tt class="descname">plotGhostContribution</tt><big>(</big><em>res</em>, <em>title</em>, <em>output</em>, <em>title2</em>, <em>output2</em><big>)</big><a class="headerlink" href="#analysis.analyseGhosts.plotGhostContribution" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="analysis.analyseGhosts.plotGhostContributionElectrons">
<tt class="descclassname">analysis.analyseGhosts.</tt><tt class="descname">plotGhostContributionElectrons</tt><big>(</big><em>log</em>, <em>res</em>, <em>title</em>, <em>output</em>, <em>title2</em>, <em>output2</em>, <em>req=0.001</em><big>)</big><a class="headerlink" href="#analysis.analyseGhosts.plotGhostContributionElectrons" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="analysis.analyseGhosts.shapeMeasurement">
<tt class="descclassname">analysis.analyseGhosts.</tt><tt class="descname">shapeMeasurement</tt><big>(</big><em>log</em><big>)</big><a class="headerlink" href="#analysis.analyseGhosts.shapeMeasurement" title="Permalink to this definition">¶</a></dt>
<dd><p>Shape measurement bias as a result of ghosts.</p>
</dd></dl>

</div>
<span class="target" id="module-analysis.nonlinearityModelTransfer"></span><div class="section" id="non-linearity-ii-model-transfer">
<h2>Non-linearity II: Model Transfer<a class="headerlink" href="#non-linearity-ii-model-transfer" title="Permalink to this headline">¶</a></h2>
<p>Most PSF stars are bright while most weak lensing galaxies are faint,
thus the PSF model needs to be transferable to an appropriate object luminosity (and colour, position, etc.).
This simple script can be used to study the error in the model transfer due to non-linearity that can be
tolerated given the requirements.</p>
<p>The following requirements related to the model transfer have been taken from CalCD-B.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">requires:</th><td class="field-body">PyFITS</td>
</tr>
<tr class="field-even field"><th class="field-name">requires:</th><td class="field-body">NumPy</td>
</tr>
<tr class="field-odd field"><th class="field-name">requires:</th><td class="field-body">SciPy</td>
</tr>
<tr class="field-even field"><th class="field-name">requires:</th><td class="field-body">matplotlib</td>
</tr>
<tr class="field-odd field"><th class="field-name">requires:</th><td class="field-body">VISsim-Python</td>
</tr>
<tr class="field-even field"><th class="field-name">version:</th><td class="field-body">0.2</td>
</tr>
<tr class="field-odd field"><th class="field-name">author:</th><td class="field-body">Sami-Matias Niemi</td>
</tr>
<tr class="field-even field"><th class="field-name">contact:</th><td class="field-body"><a class="reference external" href="mailto:s&#46;niemi&#37;&#52;&#48;ucl&#46;ac&#46;uk">s<span>&#46;</span>niemi<span>&#64;</span>ucl<span>&#46;</span>ac<span>&#46;</span>uk</a></td>
</tr>
</tbody>
</table>
<dl class="function">
<dt id="analysis.nonlinearityModelTransfer.plotResults">
<tt class="descclassname">analysis.nonlinearityModelTransfer.</tt><tt class="descname">plotResults</tt><big>(</big><em>results</em>, <em>reqe=3.5e-05</em>, <em>reqr2=0.00035</em>, <em>outdir='results'</em>, <em>timeStamp=False</em><big>)</big><a class="headerlink" href="#analysis.nonlinearityModelTransfer.plotResults" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a simple plot to combine and show the results.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>res</strong> (<em>list</em>) &#8211; results to be plotted [reference values, results dictionary]</li>
<li><strong>reqe</strong> (<em>float</em>) &#8211; the requirement for ellipticity [default=3.5e-5]</li>
<li><strong>reqr2</strong> (<em>float</em>) &#8211; the requirement for size R2 [default=3.5e-4]</li>
<li><strong>outdir</strong> (<em>str</em>) &#8211; output directory to which the plots will be saved to</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">None</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="analysis.nonlinearityModelTransfer.testNonlinearityModelTransfer">
<tt class="descclassname">analysis.nonlinearityModelTransfer.</tt><tt class="descname">testNonlinearityModelTransfer</tt><big>(</big><em>log</em>, <em>file='data/psf12x.fits'</em>, <em>oversample=12.0</em>, <em>sigma=0.75</em>, <em>psfs=5000</em>, <em>amps=12</em>, <em>multiplier=1.5</em>, <em>minerror=-5.0</em>, <em>maxerror=-1.0</em>, <em>lowflux=500</em>, <em>highflux=180000</em>, <em>linspace=False</em><big>)</big><a class="headerlink" href="#analysis.nonlinearityModelTransfer.testNonlinearityModelTransfer" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to study the error in the non-linearity correction on the knowledge of the PSF ellipticity and size.</p>
<p>The error has been assumed to follow a sinusoidal curve with random phase and a given number of angular
frequencies (defined by the multiplier). The amplitudes being studied, i.e. the size of the maximum deviation,
can be spaced either linearly or logarithmically.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>log</strong> (<em>instance</em>) &#8211; logger instance</li>
<li><strong>file</strong> (<em>str</em>) &#8211; name of the PSF FITS files to use [default=data/psf12x.fits]</li>
<li><strong>oversample</strong> &#8211; the PSF oversampling factor, which needs to match the input file [default=12]</li>
<li><strong>sigma</strong> (<em>float</em>) &#8211; 1sigma radius of the Gaussian weighting function for shape measurements</li>
<li><strong>phs</strong> (<em>float</em>) &#8211; phase in case phases = None</li>
<li><strong>phases</strong> (<em>None or int</em>) &#8211; if None then a single fixed phase will be applied, if an int then a given number of random
phases will be used</li>
<li><strong>psfs</strong> (<em>int</em>) &#8211; the number of PSFs to use.</li>
<li><strong>amps</strong> (<em>int</em>) &#8211; the number of individual samplings used when covering the error space</li>
<li><strong>multiplier</strong> (<em>int or float</em>) &#8211; the number of angular frequencies to be used</li>
<li><strong>minerror</strong> (<em>float</em>) &#8211; the minimum error to be covered, given in log10(min_error) [default=-5 i.e. 0.001%]</li>
<li><strong>maxerror</strong> (<em>float</em>) &#8211; the maximum error to be covered, given in log10(max_error) [default=-1 i.e. 10%]</li>
<li><strong>linspace</strong> (<em>boolean</em>) &#8211; whether the amplitudes of the error curves should be linearly or logarithmically spaced.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">reference value and results dictionaries</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">list</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<span class="target" id="module-analysis.analyseBackground"></span><p>This script can be used to derive statistics of background pixels.</p>
<dl class="function">
<dt id="analysis.analyseBackground.dilation">
<tt class="descclassname">analysis.analyseBackground.</tt><tt class="descname">dilation</tt><big>(</big><em>data</em><big>)</big><a class="headerlink" href="#analysis.analyseBackground.dilation" title="Permalink to this definition">¶</a></dt>
<dd><p>Use dilation to define the background. Not working too well...</p>
</dd></dl>

<dl class="function">
<dt id="analysis.analyseBackground.kde_scipy">
<tt class="descclassname">analysis.analyseBackground.</tt><tt class="descname">kde_scipy</tt><big>(</big><em>x</em>, <em>x_grid</em>, <em>bandwidth=0.2</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#analysis.analyseBackground.kde_scipy" title="Permalink to this definition">¶</a></dt>
<dd><p>Kernel Density Estimation with Scipy</p>
</dd></dl>

<dl class="function">
<dt id="analysis.analyseBackground.kde_sklearn">
<tt class="descclassname">analysis.analyseBackground.</tt><tt class="descname">kde_sklearn</tt><big>(</big><em>x</em>, <em>x_grid</em>, <em>bandwidth=0.2</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#analysis.analyseBackground.kde_sklearn" title="Permalink to this definition">¶</a></dt>
<dd><p>Kernel Density Estimation with Scikit-learn</p>
</dd></dl>

<dl class="function">
<dt id="analysis.analyseBackground.kde_statsmodels_m">
<tt class="descclassname">analysis.analyseBackground.</tt><tt class="descname">kde_statsmodels_m</tt><big>(</big><em>x</em>, <em>x_grid</em>, <em>bandwidth=0.2</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#analysis.analyseBackground.kde_statsmodels_m" title="Permalink to this definition">¶</a></dt>
<dd><p>Multivariate Kernel Density Estimation with Statsmodels</p>
</dd></dl>

<dl class="function">
<dt id="analysis.analyseBackground.kde_statsmodels_u">
<tt class="descclassname">analysis.analyseBackground.</tt><tt class="descname">kde_statsmodels_u</tt><big>(</big><em>x</em>, <em>x_grid</em>, <em>bandwidth=0.2</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#analysis.analyseBackground.kde_statsmodels_u" title="Permalink to this definition">¶</a></dt>
<dd><p>Univariate Kernel Density Estimation with Statsmodels</p>
</dd></dl>

<dl class="function">
<dt id="analysis.analyseBackground.loadData">
<tt class="descclassname">analysis.analyseBackground.</tt><tt class="descname">loadData</tt><big>(</big><em>filename</em><big>)</big><a class="headerlink" href="#analysis.analyseBackground.loadData" title="Permalink to this definition">¶</a></dt>
<dd><p>Load data, exclude pre- and over scan regions, and subtract the bias level found from the header.</p>
</dd></dl>

<dl class="function">
<dt id="analysis.analyseBackground.maskObjects">
<tt class="descclassname">analysis.analyseBackground.</tt><tt class="descname">maskObjects</tt><big>(</big><em>data</em>, <em>sigma=4.0</em>, <em>iterations=None</em><big>)</big><a class="headerlink" href="#analysis.analyseBackground.maskObjects" title="Permalink to this definition">¶</a></dt>
<dd><p>Mask objects using sigma clipping around the median.</p>
<p>Will also plot the data and the mask.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">masked numpy array</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="analysis.analyseBackground.plotEntropy">
<tt class="descclassname">analysis.analyseBackground.</tt><tt class="descname">plotEntropy</tt><big>(</big><em>filename</em><big>)</big><a class="headerlink" href="#analysis.analyseBackground.plotEntropy" title="Permalink to this definition">¶</a></dt>
<dd><p>Plots the entropy in the data. No really suitable as the input data
not in a useful format.</p>
</dd></dl>

<dl class="function">
<dt id="analysis.analyseBackground.plotStatistcs">
<tt class="descclassname">analysis.analyseBackground.</tt><tt class="descname">plotStatistcs</tt><big>(</big><em>data</em><big>)</big><a class="headerlink" href="#analysis.analyseBackground.plotStatistcs" title="Permalink to this definition">¶</a></dt>
<dd><p>Plot statistics of the background pixels. Assumes that the input contains only
the background pixel values as a 1D array.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">None</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="analysis.analyseBackground.sigmaClippedOpening">
<tt class="descclassname">analysis.analyseBackground.</tt><tt class="descname">sigmaClippedOpening</tt><big>(</big><em>data</em><big>)</big><a class="headerlink" href="#analysis.analyseBackground.sigmaClippedOpening" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform Gaussian filtering, sigma clipping and binary opening to define
a mask for the background pixels.</p>
</dd></dl>

<span class="target" id="module-analysis.analyseBackgroundSubtraction"></span><div class="section" id="background-subtraction">
<h2>Background Subtraction<a class="headerlink" href="#background-subtraction" title="Permalink to this headline">¶</a></h2>
<p>This scripts can be used to study the impact of background subtraction errors on the shape measurements.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">requires:</th><td class="field-body">NumPy</td>
</tr>
<tr class="field-even field"><th class="field-name">requires:</th><td class="field-body">SciPy</td>
</tr>
<tr class="field-odd field"><th class="field-name">requires:</th><td class="field-body">matplotlib</td>
</tr>
<tr class="field-even field"><th class="field-name">requires:</th><td class="field-body">VISsim-Python</td>
</tr>
<tr class="field-odd field"><th class="field-name">version:</th><td class="field-body">0.1</td>
</tr>
<tr class="field-even field"><th class="field-name">author:</th><td class="field-body">Sami-Matias Niemi</td>
</tr>
<tr class="field-odd field"><th class="field-name">contact:</th><td class="field-body"><a class="reference external" href="mailto:s&#46;niemi&#37;&#52;&#48;ucl&#46;ac&#46;uk">s<span>&#46;</span>niemi<span>&#64;</span>ucl<span>&#46;</span>ac<span>&#46;</span>uk</a></td>
</tr>
</tbody>
</table>
<dl class="function">
<dt id="analysis.analyseBackgroundSubtraction.simpleAnalytical">
<tt class="descclassname">analysis.analyseBackgroundSubtraction.</tt><tt class="descname">simpleAnalytical</tt><big>(</big><em>value=130</em>, <em>size=(50</em>, <em>50)</em>, <em>readnoise=4.5</em>, <em>gain=3.1</em>, <em>req=1.0</em><big>)</big><a class="headerlink" href="#analysis.analyseBackgroundSubtraction.simpleAnalytical" title="Permalink to this definition">¶</a></dt>
<dd><p>A simple function to test the area of pixels needed (defined by size) to derive the
pixel value to the level of required number of electrons given the readout noise and
the gain of the system.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>value</strong> (<em>int</em>) &#8211; the floor level in electrons to be found [default = 130]</li>
<li><strong>size</strong> (<em>tuple</em>) &#8211; area describing the number of pixels available [default = (50, 50)]</li>
<li><strong>readnoise</strong> (<em>float</em>) &#8211; readout noise of the full detection chain [default = 4.5]</li>
<li><strong>gain</strong> (<em>float</em>) &#8211; gain of the detection system [default = 3.1]</li>
<li><strong>req</strong> (<em>float</em>) &#8211; required level to reach in electrons [default = 1]</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">none</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="analysis.html" title="VIS data analysis tools"
             >next</a> |</li>
        <li class="right" >
          <a href="simulator.html" title="Simulation tools"
             >previous</a> |</li>
        <li><a href="index.html">home</a>|&nbsp;</li>
        <li><a href="search.html">search</a>|&nbsp;</li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Sami-Matias Niemi.
    </div>
  </body>
</html>