

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Simulation tools &mdash; VIS 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="VIS 0.1 documentation" href="index.html" />
    <link rel="next" title="Postprocessing tools" href="postproc.html" />
    <link rel="prev" title="Generating Object Catalogue" href="sources.html" /> 
  </head>
  <body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="postproc.html" title="Postprocessing tools"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="sources.html" title="Generating Object Catalogue"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">home</a>|&nbsp;</li>
        <li><a href="search.html">search</a>|&nbsp;</li>
 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Simulation tools</a><ul>
<li><a class="reference internal" href="#the-euclid-visible-instrument-image-simulator">The Euclid Visible Instrument Image Simulator</a><ul>
<li><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li><a class="reference internal" href="#testing">Testing</a></li>
<li><a class="reference internal" href="#benchmarking">Benchmarking</a></li>
<li><a class="reference internal" href="#change-log">Change Log</a></li>
<li><a class="reference internal" href="#future-work">Future Work</a></li>
<li><a class="reference internal" href="#contact-information">Contact Information</a></li>
</ul>
</li>
<li><a class="reference internal" href="#generating-mock-objects-with-iraf">Generating Mock Objects with IRAF</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="sources.html"
                        title="previous chapter">Generating Object Catalogue</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="postproc.html"
                        title="next chapter">Postprocessing tools</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/simulator.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="module-simulator.simulator">
<span id="simulation-tools"></span><h1>Simulation tools<a class="headerlink" href="#module-simulator.simulator" title="Permalink to this headline">¶</a></h1>
<div class="section" id="the-euclid-visible-instrument-image-simulator">
<h2>The Euclid Visible Instrument Image Simulator<a class="headerlink" href="#the-euclid-visible-instrument-image-simulator" title="Permalink to this headline">¶</a></h2>
<p>This file contains an image simulator for the Euclid VISible instrument.</p>
<p>The approximate sequence of events in the simulator is as follows:</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Read in a configuration file, which defines for example,
detector characteristics (bias, dark and readout noise, gain,
plate scale and pixel scale, oversampling factor, exposure time etc.).</p>
</li>
<li><p class="first">Read in another file containing charge trap definitions (for CTI modelling).</p>
</li>
<li><p class="first">Read in a file defining the cosmic rays (trail lengths and cumulative distributions).</p>
</li>
<li><p class="first">Read in CCD offset information, displace the image, and modify
the output file name to contain the CCD and quadrant information
(note that VIS has a focal plane of 6 x 6 detectors).</p>
</li>
<li><p class="first">Read in source list and determine the number of different object types.</p>
</li>
<li><p class="first">Read in a file which assigns data to a given object index.</p>
</li>
<li><p class="first">Load the PSF model (a single 2D map with a given over sampling or field dependent maps).</p>
</li>
<li><p class="first">Generate a finemap (oversampled image) for each object type. If an object
is a 2D image then calculate the shape tensor to be used for size scaling.
Each type of an object is then placed onto its own finely sampled finemap.</p>
</li>
<li><p class="first">Loop over the number of exposures to co-add and for each object in the object catalog:</p>
<blockquote>
<div><ul class="simple">
<li>determine the number of electrons an object should have by scaling the object&#8217;s magnitude
with the given zeropoint and exposure time.</li>
<li>determine whether the object lands on to the detector or not and if it is
a star or an extended source (i.e. a galaxy).</li>
<li>if object is extended determine the size (using a size-magnitude relation) and scale counts,
convolve with the PSF, and finally overlay onto the detector according to its position.</li>
<li>if object is a star, scale counts according to the derived
scaling (first step), and finally overlay onto the detector according to its position.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Apply a multiplicative flat-field map [optional].</p>
</li>
<li><p class="first">Add a charge injection line (horizontal and/or vertical) [optional].</p>
</li>
<li><p class="first">Add cosmic ray streaks onto the CCD with random positions but known distribution [optional].</p>
</li>
<li><p class="first">Add photon (Poisson) noise and constant dark current to the pixel grid [optional].</p>
</li>
<li><p class="first">Add cosmetic defects from an input file [optional].</p>
</li>
<li><p class="first">Add pre- and overscan regions in the serial direction [optional].</p>
</li>
<li><p class="first">Apply the CDM03 radiation damage model [optional].</p>
</li>
<li><p class="first">Add readout noise selected from a Gaussian distribution [optional].</p>
</li>
<li><p class="first">Convert from electrons to ADUs using the given gain factor.</p>
</li>
<li><p class="first">Add a given bias level and discretise the counts (16bit).</p>
</li>
<li><p class="first">Finally the generated image is converted to a FITS file and saved to the working directory.</p>
</li>
</ol>
</div></blockquote>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The code is still work in progress and new features are being added.
The code has been tested, but nevertheless bugs may be lurking in corners, so
please report any weird or inconsistent simulations to the author.</p>
</div>
<div class="section" id="dependencies">
<h3>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h3>
<p>This script depends on the following packages:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">requires:</th><td class="field-body">PyFITS (tested with 3.0.6)</td>
</tr>
<tr class="field-even field"><th class="field-name">requires:</th><td class="field-body">NumPy (tested with 1.6.1)</td>
</tr>
<tr class="field-odd field"><th class="field-name">requires:</th><td class="field-body">SciPy (tested with 0.10.1)</td>
</tr>
<tr class="field-even field"><th class="field-name">requires:</th><td class="field-body">vissim-python package</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This class is not Python 3 compatible. For example, xrange does not exist
in Python 3 (but is used here for speed and memory consumption improvements).
In addition, at least the string formatting should be changed if moved to
Python 3.x.</p>
</div>
</div>
<div class="section" id="testing">
<h3>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h3>
<p>Before trying to run the code, please make sure that you have compiled the
cdm03.f90 Fortran code using f2py (f2py -c -m cdm03 cdm03.f90). For testing,
please run the SCIENCE section from the test.config as follows:</p>
<div class="highlight-python"><pre>python simulator.py -c data/test.config -s TESTSCIENCE1X</pre>
</div>
<p>This will produce an image representing VIS lower left (0th) quadrant. Because
noise and cosmic rays are randomised one cannot directly compare the science
outputs but we must rely on the outputs that are free from random effects.</p>
<p>In the data subdirectory there is a file called &#8220;nonoisenocrQ0_00_00testscience1x.fits&#8221;,
which is the comparison image without any noise or cosmic rays. To test the functionality,
please divide your nonoise and no cosmic ray track output image with the on in the data
folder. This should lead to a uniformly unity image or at least very close given some
numerical rounding uncertainties.</p>
</div>
<div class="section" id="benchmarking">
<h3>Benchmarking<a class="headerlink" href="#benchmarking" title="Permalink to this headline">¶</a></h3>
<p>A minimal benchmarking has been performed using the TESTSCIENCE1X section of the test.config input file:</p>
<div class="highlight-python"><pre>Galaxy: 26753/26753 intscale=199.421150298 size=0.0353116000387
6798 objects were place on the detector

real        1m48.757s
user        1m44.433s
sys         0m1.425s</pre>
</div>
<p>These numbers have been obtained with my laptop (2.2 GHz Intel Core i7) with
64-bit Python 2.7.2 installation. Further speed testing can be performed using the cProfile module
as follows:</p>
<div class="highlight-python"><pre>python -m cProfile -o vissim.profile simulator.py -c data/test.config -s TESTSCIENCE3X</pre>
</div>
<p>and then analysing the results with e.g. RunSnakeRun.</p>
</div>
<div class="section" id="change-log">
<h3>Change Log<a class="headerlink" href="#change-log" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">version:</th><td class="field-body">1.0</td>
</tr>
</tbody>
</table>
<p>Version and change logs:</p>
<div class="highlight-python"><pre>0.1: pre-development backbone.
0.4: first version with most pieces together.
0.5: this version has all the basic features present, but not fully tested.
0.6: implemented pre/overscan, fixed a bug when an object was getting close to the upper right corner of an
     image it was not overlaid correctly. Included multiplicative flat fielding effect (pixel non-uniformity).
0.7: implemented bleeding.
0.8: cleaned up the code and improved documentation. Fix a bug related to checking if object falls on the CCD.
     Improved the information that is being written to the FITS header.
0.9: fixed a problem with the CTI model swapping Q1 with Q2. Fixed a bug that caused the pre- and overscan to
     be identical for each quadrant even though Q1 and 3 needs the regions to be mirrored.
1.0: First release. The code can now take an over sampled PSF and use that for convolutions. Implemented a WCS
     to the header.</pre>
</div>
</div>
<div class="section" id="future-work">
<h3>Future Work<a class="headerlink" href="#future-work" title="Permalink to this headline">¶</a></h3>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<ol class="last arabic simple">
<li>check that the size distribution of galaxies is suitable (now the scaling is before convolution!)</li>
<li>implement spatially variable PSF</li>
<li>test that the cosmic rays are correctly implemented</li>
<li>implement CCD offsets (for focal plane simulations)</li>
<li>test that the WCS is correctly implemented and allows CCD offsets</li>
<li>implement additive flat fielding (now only multiplicative pixel non-uniform effect is being simulated)</li>
<li>implement a Gaussian random draw from the size-magnitude distribution</li>
<li>centering of an object depends on the centering of the postage stamp (should re calculate the centroid)</li>
<li>charge injection line positions are now hardcoded to the code, read from the config file</li>
<li>CTI model values are not included to the FITS header</li>
<li>include rotation in metrology</li>
<li>implement optional dithered offsets</li>
<li>try to further improve the convolution speed (look into fftw package)</li>
</ol>
</div>
</div>
<div class="section" id="contact-information">
<h3>Contact Information<a class="headerlink" href="#contact-information" title="Permalink to this headline">¶</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">author:</th><td class="field-body">Sami-Matias Niemi</td>
</tr>
<tr class="field-even field"><th class="field-name">contact:</th><td class="field-body"><a class="reference external" href="mailto:smn2&#37;&#52;&#48;mssl&#46;ucl&#46;ac&#46;uk">smn2<span>&#64;</span>mssl<span>&#46;</span>ucl<span>&#46;</span>ac<span>&#46;</span>uk</a></td>
</tr>
</tbody>
</table>
</div>
</div>
<dl class="class">
<dt id="simulator.simulator.VISsimulator">
<em class="property">class </em><tt class="descclassname">simulator.simulator.</tt><tt class="descname">VISsimulator</tt><big>(</big><em>configfile</em>, <em>debug</em>, <em>section='SCIENCE'</em><big>)</big><a class="headerlink" href="#simulator.simulator.VISsimulator" title="Permalink to this definition">¶</a></dt>
<dd><p>Euclid Visible Instrument Image Simulator</p>
<p>The image that is being build is in:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>configfile</strong> (<em>string</em>) &#8211; name of the configuration file</li>
<li><strong>debug</strong> (<em>boolean</em>) &#8211; debugging mode on/off</li>
<li><strong>section</strong> (<em>str</em>) &#8211; name of the section of the configuration file to process</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="simulator.simulator.VISsimulator.addChargeInjection">
<tt class="descname">addChargeInjection</tt><big>(</big><big>)</big><a class="headerlink" href="#simulator.simulator.VISsimulator.addChargeInjection" title="Permalink to this definition">¶</a></dt>
<dd><p>Add either horizontal or vertical charge injection line to the image.</p>
</dd></dl>

<dl class="method">
<dt id="simulator.simulator.VISsimulator.addCosmicRays">
<tt class="descname">addCosmicRays</tt><big>(</big><big>)</big><a class="headerlink" href="#simulator.simulator.VISsimulator.addCosmicRays" title="Permalink to this definition">¶</a></dt>
<dd><p>Add cosmic rays to the arrays based on a power-law intensity distribution for tracks.</p>
<p>Cosmic ray properties (such as location and angle) are chosen from random Uniform distribution.</p>
</dd></dl>

<dl class="method">
<dt id="simulator.simulator.VISsimulator.addObjects">
<tt class="descname">addObjects</tt><big>(</big><big>)</big><a class="headerlink" href="#simulator.simulator.VISsimulator.addObjects" title="Permalink to this definition">¶</a></dt>
<dd><p>Add objects from the object list to the CCD image (self.image).</p>
<p>Scale the object&#8217;s brightness in electrons and size using the input catalog magnitude.
The size scaling is a crude fit to Massey et al. plot.</p>
</dd></dl>

<dl class="method">
<dt id="simulator.simulator.VISsimulator.addPreOverScans">
<tt class="descname">addPreOverScans</tt><big>(</big><big>)</big><a class="headerlink" href="#simulator.simulator.VISsimulator.addPreOverScans" title="Permalink to this definition">¶</a></dt>
<dd><p>Add pre- and overscan regions to the self.image. These areas are added only in the serial direction.
Because the 1st and 3rd quadrant are read out in to a different serial direction than the nominal
orientation, in these images the regions are mirrored.</p>
<p>The size of prescan and overscan regions are defined by the prescanx and overscanx keywords, respectively.</p>
</dd></dl>

<dl class="method">
<dt id="simulator.simulator.VISsimulator.applyBias">
<tt class="descname">applyBias</tt><big>(</big><big>)</big><a class="headerlink" href="#simulator.simulator.VISsimulator.applyBias" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a bias level to the image being constructed.</p>
<p>The value of bias is read from the configure file and stored
in the information dictionary (key bias).</p>
</dd></dl>

<dl class="method">
<dt id="simulator.simulator.VISsimulator.applyBleeding">
<tt class="descname">applyBleeding</tt><big>(</big><big>)</big><a class="headerlink" href="#simulator.simulator.VISsimulator.applyBleeding" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply bleeding along the CCD columns if the number of electrons in a pixel exceeds the full-well capacity.</p>
<p>Bleeding is modelled in the parallel direction only, because the CCD273s are assumed not to bleed in
serial direction.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">None</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="simulator.simulator.VISsimulator.applyCosmetics">
<tt class="descname">applyCosmetics</tt><big>(</big><big>)</big><a class="headerlink" href="#simulator.simulator.VISsimulator.applyCosmetics" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply cosmetic defects described in the input file.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This method does not work if the input file has exactly one line.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="simulator.simulator.VISsimulator.applyFlatfield">
<tt class="descname">applyFlatfield</tt><big>(</big><big>)</big><a class="headerlink" href="#simulator.simulator.VISsimulator.applyFlatfield" title="Permalink to this definition">¶</a></dt>
<dd><p>Applies multiplicative and/or additive flat field.</p>
<p>Because the pixel-to-pixel non-uniformity effect (i.e. multiplicative) flat fielding takes place
before CTI and other effects, the flat field file must be the same size as the pixels that see
the sky. Thus, in case of a single quadrant (x, y) = (2048, 2066).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The additive flat fielding effect has not been included yet.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="simulator.simulator.VISsimulator.applyNoise">
<tt class="descname">applyNoise</tt><big>(</big><big>)</big><a class="headerlink" href="#simulator.simulator.VISsimulator.applyNoise" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply dark current, the cosmic background, and Poisson noise.
Scales dark and background with the exposure time.</p>
<p>Additionally saves the image without noise to a FITS file.</p>
</dd></dl>

<dl class="method">
<dt id="simulator.simulator.VISsimulator.applyRadiationDamage">
<tt class="descname">applyRadiationDamage</tt><big>(</big><big>)</big><a class="headerlink" href="#simulator.simulator.VISsimulator.applyRadiationDamage" title="Permalink to this definition">¶</a></dt>
<dd><p>Applies CDM03 radiation model to the image being constructed.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">Class :<cite>CDM03</cite></p>
</div>
</dd></dl>

<dl class="method">
<dt id="simulator.simulator.VISsimulator.applyReadoutNoise">
<tt class="descname">applyReadoutNoise</tt><big>(</big><big>)</big><a class="headerlink" href="#simulator.simulator.VISsimulator.applyReadoutNoise" title="Permalink to this definition">¶</a></dt>
<dd><p>Applies readout noise to the image being constructed.</p>
<p>The noise is drawn from a Normal (Gaussian) distribution.
Mean = 0.0, and std = sqrt(readout noise).</p>
</dd></dl>

<dl class="method">
<dt id="simulator.simulator.VISsimulator.configure">
<tt class="descname">configure</tt><big>(</big><big>)</big><a class="headerlink" href="#simulator.simulator.VISsimulator.configure" title="Permalink to this definition">¶</a></dt>
<dd><p>Configures the simulator with input information and creates and empty array to which the final image will
be build on.</p>
</dd></dl>

<dl class="method">
<dt id="simulator.simulator.VISsimulator.cosmicRayIntercepts">
<tt class="descname">cosmicRayIntercepts</tt><big>(</big><em>lum</em>, <em>x0</em>, <em>y0</em>, <em>l</em>, <em>phi</em><big>)</big><a class="headerlink" href="#simulator.simulator.VISsimulator.cosmicRayIntercepts" title="Permalink to this definition">¶</a></dt>
<dd><p>Derive cosmic ray streak intercept points.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>lum</strong> &#8211; luminosities of the cosmic ray tracks</li>
<li><strong>x0</strong> &#8211; central positions of the cosmic ray tracks in x-direction</li>
<li><strong>y0</strong> &#8211; central positions of the cosmic ray tracks in y-direction</li>
<li><strong>l</strong> &#8211; lengths of the cosmic ray tracks</li>
<li><strong>phi</strong> &#8211; orientation angles of the cosmic ray tracks</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">map</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">nd-array</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="simulator.simulator.VISsimulator.discretise">
<tt class="descname">discretise</tt><big>(</big><em>max=65535</em><big>)</big><a class="headerlink" href="#simulator.simulator.VISsimulator.discretise" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a floating point image array (self.image) to an integer array with max values
defined by the argument max.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>max</strong> (<em>float</em>) &#8211; maximum value the the integer array may contain [default 65k]</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">None</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="simulator.simulator.VISsimulator.electrons2ADU">
<tt class="descname">electrons2ADU</tt><big>(</big><big>)</big><a class="headerlink" href="#simulator.simulator.VISsimulator.electrons2ADU" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert from electrons to ADUs using the value read from the configuration file.</p>
</dd></dl>

<dl class="method">
<dt id="simulator.simulator.VISsimulator.generateFinemaps">
<tt class="descname">generateFinemaps</tt><big>(</big><big>)</big><a class="headerlink" href="#simulator.simulator.VISsimulator.generateFinemaps" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates finely sampled images of the input data.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This should be rewritten. Now a direct conversion from FORTRAN, and thus
not probably very effective. Assumes the PSF sampling for other finemaps.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="simulator.simulator.VISsimulator.objectOnDetector">
<tt class="descname">objectOnDetector</tt><big>(</big><em>object</em><big>)</big><a class="headerlink" href="#simulator.simulator.VISsimulator.objectOnDetector" title="Permalink to this definition">¶</a></dt>
<dd><p>Tests if the object falls on the detector.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>object</strong> &#8211; object to be placed to the self.image.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">whether the object falls on the detector or not</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">boolean</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="simulator.simulator.VISsimulator.overlayToCCD">
<tt class="descname">overlayToCCD</tt><big>(</big><em>data</em>, <em>obj</em><big>)</big><a class="headerlink" href="#simulator.simulator.VISsimulator.overlayToCCD" title="Permalink to this definition">¶</a></dt>
<dd><p>Overlay data from a source object onto the self.image.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>data</strong> (<em>ndarray</em>) &#8211; ndarray of data to be overlaid on to self.image</li>
<li><strong>obj</strong> (<em>list</em>) &#8211; object information such as position</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="simulator.simulator.VISsimulator.processConfigs">
<tt class="descname">processConfigs</tt><big>(</big><big>)</big><a class="headerlink" href="#simulator.simulator.VISsimulator.processConfigs" title="Permalink to this definition">¶</a></dt>
<dd><p>Processes configuration information and save the information to a dictionary self.information.</p>
<p>The configuration file may look as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">TEST</span><span class="p">]</span>
<span class="n">quadrant</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">CCDx</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">CCDy</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">xsize</span> <span class="o">=</span> <span class="mi">2048</span>
<span class="n">ysize</span> <span class="o">=</span> <span class="mi">2066</span>
<span class="n">prescanx</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">ovrscanx</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">fullwellcapacity</span> <span class="o">=</span> <span class="mi">200000</span>
<span class="n">dark</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="n">readout</span> <span class="o">=</span> <span class="mf">4.5</span>
<span class="n">bias</span> <span class="o">=</span> <span class="mf">1000.0</span>
<span class="n">cosmic_bkgd</span> <span class="o">=</span> <span class="mf">0.172</span>
<span class="n">e_ADU</span> <span class="o">=</span> <span class="mf">3.5</span>
<span class="n">injection</span> <span class="o">=</span> <span class="mf">150000.0</span>
<span class="n">magzero</span> <span class="o">=</span> <span class="mf">1.7059e10</span>
<span class="n">exposures</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">exptime</span> <span class="o">=</span> <span class="mf">565.0</span>
<span class="n">RA</span> <span class="o">=</span> <span class="mf">145.95</span>
<span class="n">DEC</span> <span class="o">=</span> <span class="o">-</span><span class="mf">38.16</span>
<span class="n">sourcelist</span> <span class="o">=</span> <span class="n">data</span><span class="o">/</span><span class="n">source_test</span><span class="o">.</span><span class="n">dat</span>
<span class="n">PSFfile</span> <span class="o">=</span> <span class="n">data</span><span class="o">/</span><span class="n">interpolated_psf</span><span class="o">.</span><span class="n">fits</span>
<span class="n">trapfile</span> <span class="o">=</span> <span class="n">data</span><span class="o">/</span><span class="n">cdm_euclid</span><span class="o">.</span><span class="n">dat</span>
<span class="n">cosmeticsFile</span> <span class="o">=</span> <span class="n">data</span><span class="o">/</span><span class="n">cosmetics</span><span class="o">.</span><span class="n">dat</span>
<span class="n">flatfieldfile</span> <span class="o">=</span> <span class="n">data</span><span class="o">/</span><span class="n">VISFlatField2percent</span><span class="o">.</span><span class="n">fits</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">test</span><span class="o">.</span><span class="n">fits</span>
<span class="n">addSources</span> <span class="o">=</span> <span class="n">yes</span>
<span class="n">noise</span> <span class="o">=</span> <span class="n">yes</span>
<span class="n">cosmetics</span> <span class="o">=</span> <span class="n">no</span>
<span class="n">chargeInjectionx</span> <span class="o">=</span> <span class="n">no</span>
<span class="n">chargeInjectiony</span> <span class="o">=</span> <span class="n">no</span>
<span class="n">radiationDamage</span> <span class="o">=</span> <span class="n">yes</span>
<span class="n">cosmicRays</span> <span class="o">=</span> <span class="n">yes</span>
<span class="n">overscans</span> <span class="o">=</span> <span class="n">yes</span>
<span class="n">bleeding</span> <span class="o">=</span> <span class="n">yes</span>
<span class="n">flatfieldM</span> <span class="o">=</span> <span class="n">yes</span>
<span class="n">flatfieldA</span> <span class="o">=</span> <span class="n">no</span>
</pre></div>
</div>
<p>For explanation of each field, see /data/test.config.</p>
</dd></dl>

<dl class="method">
<dt id="simulator.simulator.VISsimulator.readConfigs">
<tt class="descname">readConfigs</tt><big>(</big><big>)</big><a class="headerlink" href="#simulator.simulator.VISsimulator.readConfigs" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads the config file information using configParser.</p>
</dd></dl>

<dl class="method">
<dt id="simulator.simulator.VISsimulator.readCosmicRayInformation">
<tt class="descname">readCosmicRayInformation</tt><big>(</big><big>)</big><a class="headerlink" href="#simulator.simulator.VISsimulator.readCosmicRayInformation" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads in the cosmic ray track information from two input files.</p>
<p>Stores the information to a dictionary called cr.</p>
</dd></dl>

<dl class="method">
<dt id="simulator.simulator.VISsimulator.readObjectlist">
<tt class="descname">readObjectlist</tt><big>(</big><big>)</big><a class="headerlink" href="#simulator.simulator.VISsimulator.readObjectlist" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads object list using numpy.loadtxt, determines the number of object types,
and finds the file that corresponds to a given object type.</p>
<p>This method also displaces the object coordinates based on the quadrant and the
CCD to be simulated.</p>
<p>If even a single object type does not have a corresponding input then this method
forces the program to exit.</p>
</dd></dl>

<dl class="method">
<dt id="simulator.simulator.VISsimulator.readPSFs">
<tt class="descname">readPSFs</tt><big>(</big><big>)</big><a class="headerlink" href="#simulator.simulator.VISsimulator.readPSFs" title="Permalink to this definition">¶</a></dt>
<dd><p>Reads in a PSF from a FITS file.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">at the moment this method supports only a single PSF file.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="simulator.simulator.VISsimulator.simulate">
<tt class="descname">simulate</tt><big>(</big><big>)</big><a class="headerlink" href="#simulator.simulator.VISsimulator.simulate" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a single simulated image of a quadrant defined by the configuration file.
Will do all steps defined in the config file sequentially.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">None</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="simulator.simulator.VISsimulator.writeFITSfile">
<tt class="descname">writeFITSfile</tt><big>(</big><em>data</em>, <em>filename</em>, <em>unsigned16bit=False</em><big>)</big><a class="headerlink" href="#simulator.simulator.VISsimulator.writeFITSfile" title="Permalink to this definition">¶</a></dt>
<dd><p>Writes out a simple FITS file.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>data</strong> (<em>ndarray</em>) &#8211; data to be written</li>
<li><strong>filename</strong> (<em>str</em>) &#8211; name of the output file</li>
<li><strong>unsigned16bit</strong> (<em>bool</em>) &#8211; whether to scale the data using bzero=32768</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">None</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="simulator.simulator.VISsimulator.writeOutputs">
<tt class="descname">writeOutputs</tt><big>(</big><big>)</big><a class="headerlink" href="#simulator.simulator.VISsimulator.writeOutputs" title="Permalink to this definition">¶</a></dt>
<dd><p>Writes out a FITS file using PyFITS and converts the image array to 16bit unsigned integer as
appropriate for VIS.</p>
<p>Updates header with the input values and flags used during simulation.</p>
</dd></dl>

</dd></dl>

<span class="target" id="module-simulator.generateGalaxies"></span><div class="section" id="generating-mock-objects-with-iraf">
<h2>Generating Mock Objects with IRAF<a class="headerlink" href="#generating-mock-objects-with-iraf" title="Permalink to this headline">¶</a></h2>
<p>This script provides a class that can be used to generate objects such as galaxies using IRAF.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">requires:</th><td class="field-body">PyRAF</td>
</tr>
<tr class="field-even field"><th class="field-name">requires:</th><td class="field-body">PyFITS</td>
</tr>
<tr class="field-odd field"><th class="field-name">requires:</th><td class="field-body">NumPy</td>
</tr>
<tr class="field-even field"><th class="field-name">author:</th><td class="field-body">Sami-Matias Niemi</td>
</tr>
<tr class="field-odd field"><th class="field-name">contact:</th><td class="field-body"><a class="reference external" href="mailto:smn2&#37;&#52;&#48;mssl&#46;ucl&#46;ac&#46;uk">smn2<span>&#64;</span>mssl<span>&#46;</span>ucl<span>&#46;</span>ac<span>&#46;</span>uk</a></td>
</tr>
<tr class="field-even field"><th class="field-name">version:</th><td class="field-body">0.1</td>
</tr>
</tbody>
</table>
</div>
<dl class="class">
<dt id="simulator.generateGalaxies.generateFakeData">
<em class="property">class </em><tt class="descclassname">simulator.generateGalaxies.</tt><tt class="descname">generateFakeData</tt><big>(</big><em>log</em>, <em>**kwargs</em><big>)</big><a class="headerlink" href="#simulator.generateGalaxies.generateFakeData" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates an image frame with stars and galaxies using IRAF&#8217;s artdata.</p>
<dl class="method">
<dt id="simulator.generateGalaxies.generateFakeData.addObjects">
<tt class="descname">addObjects</tt><big>(</big><em>inputlist='galaxies.dat'</em><big>)</big><a class="headerlink" href="#simulator.generateGalaxies.generateFakeData.addObjects" title="Permalink to this definition">¶</a></dt>
<dd><p>Add object(s) from inputlist to the output image.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>inputlist</strong> (<em>str</em>) &#8211; name of the input list</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="simulator.generateGalaxies.generateFakeData.createGalaxylist">
<tt class="descname">createGalaxylist</tt><big>(</big><em>ngalaxies=150</em>, <em>output='galaxies.dat'</em><big>)</big><a class="headerlink" href="#simulator.generateGalaxies.generateFakeData.createGalaxylist" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates an ascii file with uniform random x and y positions.
The magnitudes of galaxies are taken from an isotropic and homogeneous power-law distribution.</p>
<p>The output ascii file contains the following columns: xc yc magnitude model radius ar pa &lt;save&gt;</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>ngalaxies</strong> (<em>int</em>) &#8211; number of galaxies to include</li>
<li><strong>output</strong> (<em>str</em>) &#8211; name of the output ascii file</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="simulator.generateGalaxies.generateFakeData.createStarlist">
<tt class="descname">createStarlist</tt><big>(</big><em>nstars=20</em>, <em>output='stars.dat'</em><big>)</big><a class="headerlink" href="#simulator.generateGalaxies.generateFakeData.createStarlist" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates an ascii file with uniform random x and y positions.
The magnitudes of stars are taken from an isotropic and homogeneous power-law distribution.</p>
<p>The output ascii file contains the following columns: xc yc magnitude</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>nstars</strong> (<em>int</em>) &#8211; number of stars to include</li>
<li><strong>output</strong> (<em>str</em>) &#8211; name of the output ascii file</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="simulator.generateGalaxies.generateFakeData.maskCrazyValues">
<tt class="descname">maskCrazyValues</tt><big>(</big><em>filename=None</em><big>)</big><a class="headerlink" href="#simulator.generateGalaxies.generateFakeData.maskCrazyValues" title="Permalink to this definition">¶</a></dt>
<dd><p>For some reason mkobjects sometimes adds crazy values to an image.
This method tries to remove those values and set them to more reasonable ones.
The values &gt; 65k are set to the median of the image.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>filename</strong> (<em>str</em>) &#8211; name of the input file to modify [default = self.settings[&#8216;output&#8217;]]</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">None</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="simulator.generateGalaxies.generateFakeData.runAll">
<tt class="descname">runAll</tt><big>(</big><em>nostars=True</em><big>)</big><a class="headerlink" href="#simulator.generateGalaxies.generateFakeData.runAll" title="Permalink to this definition">¶</a></dt>
<dd><p>Run all methods sequentially.</p>
</dd></dl>

</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="postproc.html" title="Postprocessing tools"
             >next</a> |</li>
        <li class="right" >
          <a href="sources.html" title="Generating Object Catalogue"
             >previous</a> |</li>
        <li><a href="index.html">home</a>|&nbsp;</li>
        <li><a href="search.html">search</a>|&nbsp;</li>
 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Sami-Matias Niemi.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>